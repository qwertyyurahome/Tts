<select id="voiceSelect"></select>
<textarea id="text" placeholder="Enter text here..."></textarea>
<button onclick="speak()">▶ Speak</button>
<button onclick="stopSpeech()">⏹ Stop</button>

<script>
let voices = [];
const select = document.getElementById('voiceSelect');

function populateVoices() {
  voices = speechSynthesis.getVoices();
  select.innerHTML = '';
  voices.forEach((voice, i) => {
    // тільки жіночі голоси
    if(voice.name.toLowerCase().includes('female') || voice.name.toLowerCase().includes('f')) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = voice.name + ' (' + voice.lang + ')';
      select.appendChild(option);
    }
  });
}

// ⚠️ Основне: періодично перевіряємо, чи голоси завантажились
function waitForVoices() {
  if(speechSynthesis.getVoices().length === 0) {
    setTimeout(waitForVoices, 200); // чекаємо 0.2 секунди
  } else {
    populateVoices();
  }
}
waitForVoices();

let currentUtterance = null;

function speak() {
  const text = document.getElementById('text').value.trim();
  if(!text) return;
  const index = select.value;
  const utter = new SpeechSynthesisUtterance(text);
  utter.voice = voices[index];
  utter.lang = utter.voice.lang;
  speechSynthesis.cancel();
  currentUtterance = utter;
  speechSynthesis.speak(utter);
}

function stopSpeech() {
  if(currentUtterance) {
    speechSynthesis.cancel();
  }
}
</script>